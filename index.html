<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Chrono Bulward v0.2.34</title>
<style>
  body { margin:0; background:#222; color:#eee; font-family:monospace; text-align:center; }
  #gameCanvas { background:#333; display:none; margin:0 auto; border:2px solid #000; }
  #menu, #settings, #help { margin-top:20px; }
  h1 { margin:20px; }
  .unit-settings { border:1px solid #555; padding:10px; margin:10px auto; width:90%; max-width:460px; text-align:left; }
  input[type=range] { width:260px; }
  #ui { margin-top:10px; display:none; }
  #ui button { margin:5px; padding:8px 16px; font-size:14px; }
  #help, #settings { display:none; text-align:left; max-width:720px; margin:20px auto; padding:12px; background:#111; border:1px solid #555; }
  h3 { cursor:pointer; margin:10px 0; }
</style>
</head>
<body>
<h1 id="title">Chrono Bulward v0.2.34</h1>

<div id="menu">
  <button onclick="startGame()">ゲーム開始</button>
  <button onclick="showSettings()">設定</button>
  <button onclick="showHelp()">説明</button>
</div>

<!-- 設定画面 -->
<div id="settings">
  <h2>ユニット調整（キャラ名クリックで単体出現モード選択）</h2>
  <div id="unitSliders"></div>
  <div style="margin-top:8px;">
    <button onclick="backToMenu()">戻る</button>
    <button onclick="applySettingsAndStart()">ゲーム開始</button>
  </div>
</div>

<!-- 説明画面 -->
<div id="help">
  <h2>ゲームのルール</h2>
  <p>自陣（下）からユニットを召喚し、敵陣（上）から進行してくる敵を防ぎます。<br>
  ユニット同士が接触すると戦闘開始、どちらかが倒れるまで移動を停止して戦闘を続けます。</p>

  <h2>勝敗条件</h2>
  <ul>
    <li>敵ユニットが自陣に到達すると自陣HPが減少</li>
    <li>味方ユニットが敵陣に到達すると敵陣HPが減少</li>
    <li>どちらかのHPが0になると勝敗が決定</li>
  </ul>

  <h2>主要ユニット</h2>
  <ul>
    <li><b>ナイト</b>：近接</li>
    <li><b>アーチャー</b>：遠距離</li>
    <li><b>クレリック</b>：回復</li>
    <li><b>ゴーレム</b>（敵専用）：岩投げ（射程45）</li>
    <li><b>巨大オーガ</b>：ボス・近接高火力</li>
    <li><b>邪竜</b>：ボス・炎ブレス遠隔</li>
  </ul>

  <button onclick="backToMenuFromHelp()">戻る</button>
</div>

<canvas id="gameCanvas" width="400" height="600"></canvas>

<div id="ui">
  <button onclick="chooseUnit('swordsman')">ナイト召喚</button>
  <button onclick="chooseUnit('archer')">アーチャー召喚</button>
  <button onclick="chooseUnit('healer')">クレリック召喚</button>
</div>

<script>
/* =========================
   Chrono Bulward v0.2.34
   - 単体出現モード：中央レーンに1体のみ
   - 通常モード：ボス除外
========================= */

let singleSpawnUnit = null; // 単体出現モードで出す敵ユニット名

// ---- 基本ステータス ----
let unitStats = {
  // 自軍
  swordsman:{hp:120, atk:10, speed:0.25, range:25},
  archer:{hp:80, atk:8, speed:0.25, range:120},
  healer:{hp:100, atk:10, speed:0.25, range:80},
  // 敵一般
  goblin:{hp:60, atk:5, speed:0.20, range:25},
  orc:{hp:200, atk:15, speed:0.20, range:25},
  shaman:{hp:120, atk:12, speed:0.25, range:120},
  phantom:{hp:80, atk:10, speed:0.50, range:100},
  golem:{hp:400, atk:20, speed:0.10, range:45},
  // ボス
  ogre:{hp:1500, atk:40, speed:0.10, range:30},
  dragon:{hp:3000, atk:70, speed:0.15, range:120}
};

// ---- スライダー設定（全ユニット） ----
const unitConfig = {
  swordsman:{name:"ナイト", props:{hp:[50,300], atk:[5,30], speed:[0.1,1,0.05], range:[10,100]}},
  archer:{name:"アーチャー", props:{hp:[40,200], atk:[5,30], speed:[0.1,1,0.05], range:[30,150]}},
  healer:{name:"クレリック", props:{hp:[40,200], atk:[5,30], speed:[0.1,1,0.05], range:[30,150]}},
  goblin:{name:"ゴブリン", props:{hp:[20,200], atk:[2,20], speed:[0.1,1,0.05], range:[10,100]}},
  orc:{name:"オーク", props:{hp:[100,500], atk:[10,50], speed:[0.05,0.5,0.05], range:[10,100]}},
  shaman:{name:"シャーマン", props:{hp:[50,250], atk:[5,30], speed:[0.1,0.5,0.05], range:[50,150]}},
  phantom:{name:"ファントム", props:{hp:[30,150], atk:[5,25], speed:[0.2,1,0.05], range:[30,120]}},
  golem:{name:"ゴーレム", props:{hp:[200,1000], atk:[10,50], speed:[0.05,0.3,0.05], range:[30,80]}},
  ogre:{name:"巨大オーガ", props:{hp:[800,3000], atk:[20,100], speed:[0.05,0.3,0.01], range:[20,60]}},
  dragon:{name:"邪竜", props:{hp:[2000,6000], atk:[50,200], speed:[0.05,0.3,0.01], range:[80,200]}}
};

// ---- 設定UI生成 ----
const unitSlidersDiv = document.getElementById("unitSliders");
for (let key in unitConfig){
  let html = `<div class="unit-settings"><h3 onclick="setSingleSpawn('${key}')">${unitConfig[key].name}</h3>`;
  for (let prop in unitConfig[key].props){
    const [min,max,step=1] = unitConfig[key].props[prop];
    const val = unitStats[key][prop];
    html += `${prop.toUpperCase()}: <input type="range" id="${key}_${prop}" min="${min}" max="${max}" step="${step}" value="${val}" oninput="updateLabel('${key}_${prop}')">
             <span id="${key}_${prop}_val">${val}</span><br>`;
  }
  html += `</div>`;
  unitSlidersDiv.innerHTML += html;
}
function updateLabel(id){ const el=document.getElementById(id), v=document.getElementById(id+"_val"); if(el&&v) v.textContent=el.value; }
function applySettingsAndStart(){
  for (let key in unitStats){
    for (let prop in unitStats[key]){
      const el = document.getElementById(`${key}_${prop}`);
      if(el) unitStats[key][prop] = parseFloat(el.value);
    }
  }
  startGame();
}
function setSingleSpawn(unit){
  singleSpawnUnit = unit;
  alert(unit + " の単体出現モードを選択しました。ゲーム開始ボタンを押してください。");
}

// ---- 画面切替 ----
function showSettings(){ document.getElementById("menu").style.display="none"; document.getElementById("settings").style.display="block"; }
function backToMenu(){ document.getElementById("settings").style.display="none"; document.getElementById("menu").style.display="block"; }
function showHelp(){ document.getElementById("menu").style.display="none"; document.getElementById("help").style.display="block"; }
function backToMenuFromHelp(){ document.getElementById("help").style.display="none"; document.getElementById("menu").style.display="block"; }

// ---- spawnEnemy 修正版 ----
function spawnEnemy(){
  if(singleSpawnUnit){
    // 単体出現モード：中央レーンに1体のみ
    const lane = 2;
    enemyUnits.push(new Unit(singleSpawnUnit, "enemy", lane, 40));
    if(enemySpawnTimer){ clearInterval(enemySpawnTimer); enemySpawnTimer = null; }
    return;
  }
  // 通常モード：ボスは出さない
  const lane = Math.floor(Math.random()*5);
  const pool = ["goblin","orc","golem","shaman","phantom"];
  const type = pool[Math.floor(Math.random()*pool.length)];
  enemyUnits.push(new Unit(type,"enemy",lane,40));
}

// ---- 以降の本体ロジック（安定版どおり） ----
// Unitクラス, Projectile類, startGame, loop, endScreen などは安定版のまま。
// （前回v0.2.33のクラス定義やloop処理をそのまま流用してください）
</script>
</body>
</html>
